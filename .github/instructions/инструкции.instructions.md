---
applyTo: 'Командир ожидает от тебя абсолютно чистый, production-уровня
Python-проект: 0 ошибок и 0 предупреждений от форматтера, линтера
и типизатора. В начале работы определи корень проекта, версию Python
и конфиги (pyproject.toml / setup.cfg / mypy.ini и т.п.). Получи список
всех *.py-файлов и обрабатывай их строго по одному, не переходя к
следующему, пока текущий не доведён до идеала.

Все файлы кода должны быть в кодировке UTF-8 без BOM. При необходимости
преобразуй файл в UTF-8 и удали любые артефакты старых кодировок.
Длина строки — максимум 79 символов: при форматировании обязательно
переноси длинные выражения, литералы и вызовы функций, сохраняй
читабельность и не ломай логическую структуру кода.

Сначала приводи стиль в порядок: выравнивай отступы (4 пробела),
исправляй пробелы вокруг операторов, форматируй многострочные
конструкции, списки, словари и docstring’и по PEP 8. Имена функций,
переменных и методов — в snake_case, классов — в PascalCase, констант —
в UPPER_CASE. Удаляй мёртвый код, временные принты и отладочные костыли.

Импорты должны соответствовать логике isort/ruff: три блока
(stdlib → сторонние библиотеки → локальные модули), внутри каждого —
алфавитная сортировка. Удаляй неиспользуемые импорты, заменяй
`from x import *` на явный список, приводя относительные и абсолютные
импорты к единому стилю проекта. При циклических импортax выноси
типизацию в `if TYPE_CHECKING:` или реорганизуй модули.

Типизацию доводи до строгого уровня: все публичные функции и методы
должны иметь точные аннотации аргументов и возвращаемых значений.
Избегай неявного `Any`, корректно используй `Optional` и `Union`, не
игнорируй ошибки mypy/pyright. Исправляй несоответствия сигнатур и
вызовов так, чтобы типизатор проходил проект целиком без ошибок и
предупреждений.

По линтингу ориентируйся на строгий режим (ruff/pylint): исправляй
все замечания, включая «мелкие» — неиспользуемые переменные,
дублирование кода, слишком сложные функции, голые `except:`, опасные
конструкции и подозрительные логические выражения. При правках не
меняй бизнес-логику, но разбивай перегруженные участки на более
простые и понятные.

Пайплайн для каждого файла: привести в UTF-8 → отформатировать с
ограничением в 79 символов → упорядочить импорты → прогнать линтер
до 0 ошибок/предупреждений → прогнать типизатор до 0 ошибок → при
необходимости запустить тесты/модуль, чтобы исключить runtime-ошибки.
Повторяй до тех пор, пока весь проект целиком не проходит форматтер,
линтер и типизатор «на чисто».
'
---
Provide project context and coding guidelines that AI should follow when generating code, answering questions, or reviewing changes.