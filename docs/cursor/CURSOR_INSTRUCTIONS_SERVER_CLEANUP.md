# üéØ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Cursor IDE - –ù–∞–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –Ω–∞ Production —Å–µ—Ä–≤–µ—Ä–µ

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-16  
**–ü—Ä–æ–µ–∫—Ç:** SigmaTrade Bot (Python –≤–µ—Ä—Å–∏—è)  
**–°–µ—Ä–≤–µ—Ä:** 34.88.234.78 (europe-north1-a)  
**–¢–µ–∫—É—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 98%  
**–¶–µ–ª—å:** –ù–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ production –¥–µ–ø–ª–æ—é

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞](#—Ç–µ–∫—É—â–µ–µ-—Å–æ—Å—Ç–æ—è–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (P0)](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–∑–∞–¥–∞—á–∏-p0)
3. [–í–∞–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ (P1)](#–≤–∞–∂–Ω—ã–µ-–∑–∞–¥–∞—á–∏-p1)
4. [–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–∏-–≤–∞–ª–∏–¥–∞—Ü–∏—è)
5. [–î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä](#–¥–µ–ø–ª–æ–π-–Ω–∞-—Å–µ—Ä–≤–µ—Ä)
6. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ø–æ–¥–¥–µ—Ä–∂–∫–∞)

---

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–û–ï–ö–¢–ê

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (98%)
- ‚úÖ –í—Å–µ Python –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã (User, Deposit, Transaction, etc.)
- ‚úÖ –í—Å–µ repositories —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –í—Å–µ services —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (–≤–∫–ª—é—á–∞—è BlockchainService)
- ‚úÖ –í—Å–µ bot handlers –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –í—Å–µ middlewares —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ FSM states –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ Background jobs (Dramatiq + APScheduler)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è

### ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è (2%)
- ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚ö†Ô∏è –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚ö†Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ staging (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ backup –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ó–ê–î–ê–ß–ò (P0)

### –ó–∞–¥–∞—á–∞ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 - –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–§–∞–π–ª—ã:**
- `scripts/server-deploy.sh`
- `scripts/setup-env.sh`
- `scripts/validate-env.py`
- `scripts/check-readiness.sh`

**–î–µ–π—Å—Ç–≤–∏—è:**

#### 1.1 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å server-deploy.sh
```bash
# –§–∞–π–ª: scripts/server-deploy.sh

# –ü–†–û–í–ï–†–ò–¢–¨:
# ‚úÖ –í—Å–µ –ø—É—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
# ‚úÖ Git branch –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
# ‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã
# ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
# ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

# –î–û–ë–ê–í–ò–¢–¨ –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
# 1. –ü—Ä–æ–≤–µ—Ä–∫—É –≤–µ—Ä—Å–∏–∏ Python (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 3.11+)
# 2. –ü—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ª–∏—á–∏—è Docker
# 3. –ü—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ /opt/sigmatradebot
# 4. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .env –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
```

#### 1.2 –£–ª—É—á—à–∏—Ç—å validate-env.py
```python
# –§–∞–π–ª: scripts/validate-env.py

# –î–û–ë–ê–í–ò–¢–¨ –ø—Ä–æ–≤–µ—Ä–∫–∏:
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ TELEGRAM_BOT_TOKEN (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å —Ü–∏—Ñ—Ä –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å ":")
# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ WALLET_ADDRESS (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å "0x" –∏ –±—ã—Ç—å 42 —Å–∏–º–≤–æ–ª–∞)
# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ DATABASE_URL (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å postgresql+asyncpg://)
# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ ADMIN_TELEGRAM_IDS —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞
# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ RPC_URL (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π URL)
# 6. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è default –∑–Ω–∞—á–µ–Ω–∏—è (changeme, etc.)

# –ü–†–ò–ú–ï–† –ö–û–î–ê:
import re
from urllib.parse import urlparse

def validate_telegram_token(token: str) -> bool:
    """Validate Telegram bot token format."""
    pattern = r'^\d+:[A-Za-z0-9_-]{35}$'
    return bool(re.match(pattern, token))

def validate_wallet_address(address: str) -> bool:
    """Validate Ethereum wallet address."""
    return address.startswith('0x') and len(address) == 42

def validate_database_url(url: str) -> bool:
    """Validate PostgreSQL connection string."""
    try:
        parsed = urlparse(url)
        return (
            parsed.scheme == 'postgresql+asyncpg' and
            parsed.hostname is not None and
            parsed.username is not None
        )
    except:
        return False

# –î–û–ë–ê–í–ò–¢–¨ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

#### 1.3 –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è
```bash
# –§–∞–π–ª: scripts/health-check.sh (–°–û–ó–î–ê–¢–¨ –ù–û–í–´–ô)

#!/bin/bash
# Health check script for production server

set -euo pipefail

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

log() { echo -e "${GREEN}‚úÖ${NC} $1"; }
error() { echo -e "${RED}‚ùå${NC} $1"; }
warn() { echo -e "${YELLOW}‚ö†Ô∏è${NC} $1"; }

echo "üîç SigmaTrade Bot - Health Check"
echo "================================"
echo ""

# 1. Check Docker containers
echo "1. Checking Docker containers..."
if docker-compose -f docker-compose.python.yml ps | grep -q "Up"; then
    log "Docker containers are running"
else
    error "Docker containers are not running"
    exit 1
fi

# 2. Check PostgreSQL
echo "2. Checking PostgreSQL..."
if docker exec sigmatrade-postgres pg_isready -U sigmatrade &>/dev/null; then
    log "PostgreSQL is healthy"
else
    error "PostgreSQL is not responding"
    exit 1
fi

# 3. Check Redis
echo "3. Checking Redis..."
if docker exec sigmatrade-redis redis-cli ping &>/dev/null; then
    log "Redis is healthy"
else
    error "Redis is not responding"
    exit 1
fi

# 4. Check Bot logs for errors
echo "4. Checking bot logs for errors..."
ERRORS=$(docker logs sigmatrade-bot --tail 100 2>&1 | grep -i "error\|exception\|traceback" | wc -l)
if [ "$ERRORS" -eq 0 ]; then
    log "No errors in bot logs"
else
    warn "Found $ERRORS errors in bot logs (last 100 lines)"
fi

# 5. Check disk space
echo "5. Checking disk space..."
DISK_USAGE=$(df -h / | tail -1 | awk '{print $5}' | sed 's/%//')
if [ "$DISK_USAGE" -lt 80 ]; then
    log "Disk space is OK (${DISK_USAGE}% used)"
else
    warn "Disk space is running low (${DISK_USAGE}% used)"
fi

# 6. Check database size
echo "6. Checking database size..."
DB_SIZE=$(docker exec sigmatrade-postgres psql -U sigmatrade -d sigmatrade -t -c "SELECT pg_size_pretty(pg_database_size('sigmatrade'));" | xargs)
log "Database size: $DB_SIZE"

# 7. Check last backup
echo "7. Checking last backup..."
if [ -d "/opt/sigmatradebot/backups" ]; then
    LAST_BACKUP=$(ls -t /opt/sigmatradebot/backups/*.sql.gz 2>/dev/null | head -1)
    if [ -n "$LAST_BACKUP" ]; then
        BACKUP_AGE=$(( ($(date +%s) - $(stat -c %Y "$LAST_BACKUP")) / 86400 ))
        if [ "$BACKUP_AGE" -le 1 ]; then
            log "Recent backup found (${BACKUP_AGE} days old)"
        else
            warn "Last backup is ${BACKUP_AGE} days old"
        fi
    else
        warn "No backups found"
    fi
else
    warn "Backup directory does not exist"
fi

echo ""
echo "‚úÖ Health check complete!"
```

---

### –ó–∞–¥–∞—á–∞ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 - –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–§–∞–π–ª—ã:**
- `docker-compose.python.yml`
- `Dockerfile.python`
- `docker-entrypoint.sh`

**–î–µ–π—Å—Ç–≤–∏—è:**

#### 2.1 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å docker-compose.python.yml
```yaml
# –§–∞–π–ª: docker-compose.python.yml

# –ü–†–û–í–ï–†–ò–¢–¨:
# ‚úÖ –í—Å–µ environment variables –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è
# ‚úÖ Health checks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
# ‚úÖ Volumes –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
# ‚úÖ Networks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
# ‚úÖ Restart policies —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

# –î–û–ë–ê–í–ò–¢–¨ –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
services:
  bot:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ...
    
    # –î–û–ë–ê–í–ò–¢–¨ health check –¥–ª—è –±–æ—Ç–∞
    healthcheck:
      test: ["CMD-SHELL", "python3 -c 'import asyncio; from bot.main import bot; asyncio.run(bot.get_me())'"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 30s
```

#### 2.2 –£–ª—É—á—à–∏—Ç—å docker-entrypoint.sh
```bash
# –§–∞–π–ª: docker-entrypoint.sh

# –î–û–ë–ê–í–ò–¢–¨:
# 1. –ü—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
# 2. –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PostgreSQL –∏ Redis
# 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã "bot"
# 4. –õ—É—á—à–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

# –ü–†–ò–ú–ï–† –£–õ–£–ß–®–ï–ù–ò–ô:

#!/bin/bash
set -e

# –§—É–Ω–∫—Ü–∏—è –æ–∂–∏–¥–∞–Ω–∏—è PostgreSQL
wait_for_postgres() {
    echo "‚è≥ Waiting for PostgreSQL..."
    while ! nc -z postgres 5432; do
        sleep 1
    done
    echo "‚úÖ PostgreSQL is ready"
}

# –§—É–Ω–∫—Ü–∏—è –æ–∂–∏–¥–∞–Ω–∏—è Redis
wait_for_redis() {
    echo "‚è≥ Waiting for Redis..."
    while ! nc -z redis 6379; do
        sleep 1
    done
    echo "‚úÖ Redis is ready"
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
if [ -z "$DATABASE_URL" ]; then
    echo "‚ùå ERROR: DATABASE_URL is not set"
    exit 1
fi

if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
    echo "‚ùå ERROR: TELEGRAM_BOT_TOKEN is not set"
    exit 1
fi

# –û–∂–∏–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
wait_for_postgres
wait_for_redis

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π —Ç–æ–ª—å–∫–æ –¥–ª—è –±–æ—Ç–∞
if [ "$1" = "bot" ]; then
    echo "üîÑ Running database migrations..."
    alembic upgrade head || {
        echo "‚ùå Migration failed!"
        echo "üìã Migration status:"
        alembic current
        echo ""
        echo "‚ö†Ô∏è  Continuing anyway (set EXIT_ON_MIGRATION_ERROR=true to stop)"
        # exit 1  # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è production
    }
fi

# –ó–∞–ø—É—Å–∫ –∫–æ–º–∞–Ω–¥—ã
case "$1" in
    bot)
        echo "ü§ñ Starting Telegram Bot..."
        exec python -m bot.main
        ;;
    worker)
        echo "‚öôÔ∏è  Starting Dramatiq Worker..."
        exec dramatiq jobs.broker --processes 2 --threads 4
        ;;
    scheduler)
        echo "‚è∞ Starting Task Scheduler..."
        exec python -m jobs.scheduler
        ;;
    *)
        exec "$@"
        ;;
esac
```

---

### –ó–∞–¥–∞—á–∞ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 - –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–§–∞–π–ª—ã:**
- `.env.example`
- `app/config/settings.py`

**–î–µ–π—Å—Ç–≤–∏—è:**

#### 3.1 –£–ª—É—á—à–∏—Ç—å .env.example
```bash
# –§–∞–π–ª: .env.example

# –î–û–ë–ê–í–ò–¢–¨ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã:

# ============= TELEGRAM BOT =============
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –æ—Ç @BotFather –≤ Telegram
# –§–æ—Ä–º–∞—Ç: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather
TELEGRAM_BOT_USERNAME=your_bot_username

# ============= DATABASE =============
# PostgreSQL connection string
# –§–æ—Ä–º–∞—Ç: postgresql+asyncpg://username:password@host:port/database
# ‚ö†Ô∏è –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –≤ production!
DATABASE_URL=postgresql+asyncpg://botuser:STRONG_PASSWORD_HERE@localhost:5432/sigmatradebot
DATABASE_ECHO=false

# ============= ADMIN =============
# Telegram user IDs –∞–¥–º–∏–Ω–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
# –ü–æ–ª—É—á–∏—Ç–µ —Å–≤–æ–π ID –æ—Ç @userinfobot
ADMIN_TELEGRAM_IDS=123456789,987654321

# ============= WALLET & BLOCKCHAIN =============
# ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –•—Ä–∞–Ω–∏—Ç–µ private key –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!
# –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –≤ git!
WALLET_PRIVATE_KEY=your_wallet_private_key_here
WALLET_ADDRESS=0xYourWalletAddress  # –î–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å 0x
USDT_CONTRACT_ADDRESS=0x55d398326f99059fF775485246999027B3197955  # BSC USDT
RPC_URL=https://bsc-dataseed.binance.org/  # BSC mainnet
SYSTEM_WALLET_ADDRESS=0xYourSystemWalletAddress  # –î–ª—è –ø—Ä–∏–µ–º–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤

# ============= REDIS =============
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=  # –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –µ—Å–ª–∏ –Ω–µ—Ç –ø–∞—Ä–æ–ª—è
REDIS_DB=0

# ============= DEPOSIT LEVELS (–≤ USDT) =============
DEPOSIT_LEVEL_1=50.0
DEPOSIT_LEVEL_2=100.0
DEPOSIT_LEVEL_3=250.0
DEPOSIT_LEVEL_4=500.0
DEPOSIT_LEVEL_5=1000.0

# ============= SECURITY =============
# ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–µ –∫–ª—é—á–∏!
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: openssl rand -hex 32
SECRET_KEY=your_secret_key_here_generate_with_openssl
ENCRYPTION_KEY=your_encryption_key_here_generate_with_openssl

# ============= APPLICATION =============
ENVIRONMENT=production  # production | development | staging
DEBUG=false  # –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ true –≤ production!
LOG_LEVEL=INFO  # DEBUG | INFO | WARNING | ERROR

# ============= BROADCAST SETTINGS =============
BROADCAST_RATE_LIMIT=15  # —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
BROADCAST_COOLDOWN=900  # 15 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

# ============= ROI SETTINGS =============
ROI_DAILY_PERCENT=0.02  # 2% –≤ –¥–µ–Ω—å
ROI_CAP_MULTIPLIER=5.0  # 500% –∫–∞–ø

# ============= POSTGRES (–¥–ª—è Docker) =============
# –≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è docker-compose.python.yml
POSTGRES_DB=sigmatrade
POSTGRES_USER=sigmatrade
POSTGRES_PASSWORD=changeme  # ‚ö†Ô∏è –ò–ó–ú–ï–ù–ò–¢–ï –≤ production!
POSTGRES_PORT=5432
```

#### 3.2 –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ settings.py
```python
# –§–∞–π–ª: app/config/settings.py

# –î–û–ë–ê–í–ò–¢–¨ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é:

from pydantic import field_validator, model_validator
import re

class Settings(BaseSettings):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...

    @field_validator('telegram_bot_token')
    @classmethod
    def validate_bot_token(cls, v: str) -> str:
        """Validate Telegram bot token format."""
        pattern = r'^\d+:[A-Za-z0-9_-]{35}$'
        if not re.match(pattern, v):
            raise ValueError(
                'Invalid Telegram bot token format. '
                'Expected format: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz'
            )
        return v

    @field_validator('wallet_address', 'system_wallet_address')
    @classmethod
    def validate_eth_address(cls, v: str) -> str:
        """Validate Ethereum address format."""
        if not v.startswith('0x') or len(v) != 42:
            raise ValueError(
                f'Invalid Ethereum address: {v}. '
                'Must start with 0x and be 42 characters long.'
            )
        return v

    @field_validator('database_url')
    @classmethod
    def validate_database_url(cls, v: str) -> str:
        """Validate database URL."""
        if not v.startswith('postgresql+asyncpg://'):
            raise ValueError(
                'Invalid database URL. Must use postgresql+asyncpg:// driver'
            )
        if 'changeme' in v.lower():
            raise ValueError(
                'Database password cannot be "changeme" in production!'
            )
        return v

    @field_validator('secret_key', 'encryption_key')
    @classmethod
    def validate_keys(cls, v: str) -> str:
        """Validate security keys."""
        if len(v) < 32:
            raise ValueError('Security keys must be at least 32 characters long')
        if v.lower() in ['your_secret_key', 'changeme', 'default']:
            raise ValueError('Please generate a secure random key!')
        return v

    @model_validator(mode='after')
    def validate_production_settings(self) -> 'Settings':
        """Additional validation for production environment."""
        if self.environment == 'production':
            # –í production –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å DEBUG=true
            if self.debug:
                raise ValueError('DEBUG must be False in production!')
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
            if 'changeme' in self.database_url.lower():
                raise ValueError('Change default database password!')
        
        return self

    def get_admin_ids(self) -> list[int]:
        """Parse admin IDs from comma-separated string."""
        if not self.admin_telegram_ids:
            return []
        try:
            return [
                int(id_.strip())
                for id_ in self.admin_telegram_ids.split(",")
                if id_.strip()
            ]
        except ValueError as e:
            raise ValueError(
                f'Invalid admin IDs format: {self.admin_telegram_ids}. '
                f'Must be comma-separated numbers. Error: {e}'
            )
```

---

### –ó–∞–¥–∞—á–∞ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 - –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–§–∞–π–ª—ã:**
- `bot/main.py`
- `bot/middlewares/*.py`
- `app/services/*.py`

**–î–µ–π—Å—Ç–≤–∏—è:**

#### 4.1 –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ bot/main.py
```python
# –§–∞–π–ª: bot/main.py

# –î–û–ë–ê–í–ò–¢–¨ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫:

from aiogram import Bot, Dispatcher
from aiogram.types import Update, ErrorEvent
from loguru import logger
import traceback

async def error_handler(event: ErrorEvent, bot: Bot) -> None:
    """
    Global error handler for all unhandled exceptions.
    """
    logger.error(
        "Unhandled exception occurred",
        exc_info=event.exception,
        extra={
            "update": event.update.model_dump() if event.update else None,
            "traceback": traceback.format_exc(),
        }
    )
    
    # –£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–æ–≤ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ
    admin_ids = settings.get_admin_ids()
    if admin_ids and event.update:
        error_text = (
            "‚ùå <b>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞!</b>\n\n"
            f"<code>{type(event.exception).__name__}: {str(event.exception)}</code>\n\n"
            f"Update ID: {event.update.update_id if event.update else 'N/A'}"
        )
        
        for admin_id in admin_ids[:3]:  # –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–µ—Ä–≤—ã—Ö 3 –∞–¥–º–∏–Ω–æ–≤
            try:
                await bot.send_message(
                    chat_id=admin_id,
                    text=error_text,
                    parse_mode="HTML"
                )
            except Exception as e:
                logger.error(f"Failed to notify admin {admin_id}: {e}")

# –í main():
async def main():
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—à–∏–±–æ–∫
    dp.errors.register(error_handler)
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
```

---

## üü° –í–ê–ñ–ù–´–ï –ó–ê–î–ê–ß–ò (P1)

### –ó–∞–¥–∞—á–∞ 5: –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 - –í–∞–∂–Ω–æ  
**–§–∞–π–ª—ã:**
- `tests/unit/test_settings.py` (–°–û–ó–î–ê–¢–¨)
- `tests/integration/test_deployment.py` (–°–û–ó–î–ê–¢–¨)

**–î–µ–π—Å—Ç–≤–∏—è:**

#### 5.1 –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è settings.py
```python
# –§–∞–π–ª: tests/unit/test_settings.py (–°–û–ó–î–ê–¢–¨ –ù–û–í–´–ô)

import pytest
from pydantic import ValidationError
from app.config.settings import Settings

def test_invalid_telegram_token():
    """Test that invalid Telegram token raises error."""
    with pytest.raises(ValidationError):
        Settings(
            telegram_bot_token="invalid_token",
            database_url="postgresql+asyncpg://user:pass@localhost/db",
            wallet_address="0x" + "a" * 40,
            usdt_contract_address="0x" + "b" * 40,
            rpc_url="https://bsc.example.com",
            system_wallet_address="0x" + "c" * 40,
            secret_key="a" * 32,
            encryption_key="b" * 32,
            admin_telegram_ids="123456789"
        )

def test_invalid_wallet_address():
    """Test that invalid wallet address raises error."""
    with pytest.raises(ValidationError):
        Settings(
            telegram_bot_token="123456789:ABCdefGHIjklMNOpqrsTUVwxyz123",
            database_url="postgresql+asyncpg://user:pass@localhost/db",
            wallet_address="invalid_address",  # Invalid
            usdt_contract_address="0x" + "b" * 40,
            rpc_url="https://bsc.example.com",
            system_wallet_address="0x" + "c" * 40,
            secret_key="a" * 32,
            encryption_key="b" * 32,
            admin_telegram_ids="123456789"
        )

def test_debug_not_allowed_in_production():
    """Test that DEBUG=True is not allowed in production."""
    with pytest.raises(ValidationError):
        Settings(
            telegram_bot_token="123456789:ABCdefGHIjklMNOpqrsTUVwxyz123",
            database_url="postgresql+asyncpg://user:pass@localhost/db",
            wallet_address="0x" + "a" * 40,
            usdt_contract_address="0x" + "b" * 40,
            rpc_url="https://bsc.example.com",
            system_wallet_address="0x" + "c" * 40,
            secret_key="a" * 32,
            encryption_key="b" * 32,
            admin_telegram_ids="123456789",
            environment="production",
            debug=True  # Should fail
        )

def test_weak_password_not_allowed():
    """Test that weak passwords are rejected."""
    with pytest.raises(ValidationError):
        Settings(
            telegram_bot_token="123456789:ABCdefGHIjklMNOpqrsTUVwxyz123",
            database_url="postgresql+asyncpg://user:changeme@localhost/db",  # Weak password
            wallet_address="0x" + "a" * 40,
            usdt_contract_address="0x" + "b" * 40,
            rpc_url="https://bsc.example.com",
            system_wallet_address="0x" + "c" * 40,
            secret_key="a" * 32,
            encryption_key="b" * 32,
            admin_telegram_ids="123456789",
            environment="production"
        )
```

---

### –ó–∞–¥–∞—á–∞ 6: –£–ª—É—á—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–µ–ø–ª–æ—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 - –í–∞–∂–Ω–æ  
**–§–∞–π–ª—ã:**
- `DEPLOY_TO_SERVER.md`
- `docs/production/DEPLOYMENT.md`

**–î–µ–π—Å—Ç–≤–∏—è:**

#### 6.1 –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è"
```markdown
# –î–æ–±–∞–≤–∏—Ç—å –≤ DEPLOY_TO_SERVER.md:

## üîß –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Bot –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /start
- –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –æ—à–∏–±–æ–∫

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
docker-compose -f docker-compose.python.yml ps

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose -f docker-compose.python.yml logs bot | tail -100

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω
grep TELEGRAM_BOT_TOKEN .env

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–æ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
curl -s https://api.telegram.org/bot${BOT_TOKEN}/getMe | jq .

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
docker-compose -f docker-compose.python.yml restart bot
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–°–∏–º–ø—Ç–æ–º—ã:**
- "connection refused" –≤ –ª–æ–≥–∞—Ö
- "password authentication failed"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç
docker exec sigmatrade-postgres pg_isready

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DATABASE_URL
grep DATABASE_URL .env

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ –±–∞–∑–µ
docker exec -it sigmatrade-postgres psql -U sigmatrade -c "\du"

# 4. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
docker-compose -f docker-compose.python.yml down -v
docker-compose -f docker-compose.python.yml up -d postgres
# –ü–æ–¥–æ–∂–¥–∞—Ç—å 10 —Å–µ–∫—É–Ω–¥
docker-compose -f docker-compose.python.yml up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: BlockchainService –æ—à–∏–±–∫–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
- "Failed to connect to BSC RPC"
- "Invalid RPC URL"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RPC_URL
grep RPC_URL .env

# 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RPC endpoint
curl -X POST -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}' \
  https://bsc-dataseed.binance.org/

# 3. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ RPC
# - https://bsc-dataseed1.defibit.io/
# - https://bsc-dataseed.bnbchain.org/

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏
docker-compose -f docker-compose.python.yml logs bot | grep -i blockchain
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- "alembic: command not found"
- "No such table"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –í—Ä—É—á–Ω—É—é –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
docker exec sigmatrade-bot alembic upgrade head

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
docker exec sigmatrade-bot alembic current

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
docker exec sigmatrade-bot alembic history

# 4. –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã, –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É
docker-compose -f docker-compose.python.yml down
docker volume rm sigmatradebot_postgres_data
docker-compose -f docker-compose.python.yml up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: Worker –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ó–∞–¥–∞—á–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏
- Worker –≤ –ª–æ–≥–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å worker
docker-compose -f docker-compose.python.yml ps worker

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ worker
docker-compose -f docker-compose.python.yml logs worker | tail -100

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis
docker exec sigmatrade-redis redis-cli ping

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
docker exec sigmatrade-redis redis-cli -c "LLEN default"

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å worker
docker-compose -f docker-compose.python.yml restart worker
```
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ò –í–ê–õ–ò–î–ê–¶–ò–Ø

### –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ –í–°–ï –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–∞ production:**

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
- [ ] –í—Å–µ —Ñ–∞–π–ª—ã –∏–∑ P0 –∑–∞–¥–∞—á –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —É–ª—É—á—à–µ–Ω–∞
- [ ] –¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ù–µ—Ç TODO –∏–ª–∏ FIXME –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤
- [ ] `scripts/server-deploy.sh` - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] `scripts/validate-env.py` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- [ ] `scripts/check-readiness.sh` - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] `scripts/health-check.sh` - —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
- [ ] `docker-compose.python.yml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- [ ] `Dockerfile.python` - –æ–±—Ä–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] `docker-entrypoint.sh` - –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

#### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] `.env.example` - —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- [ ] `settings.py` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ
- [ ] –ù–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö

#### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [ ] `DEPLOY_TO_SERVER.md` - –∞–∫—Ç—É–∞–ª—å–Ω–∞ –∏ –ø–æ–ª–Ω–∞—è
- [ ] `docs/production/DEPLOYMENT.md` - —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- [ ] –†–∞–∑–¥–µ–ª "–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã" –¥–æ–±–∞–≤–ª–µ–Ω
- [ ] –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã

---

## üöÄ –î–ï–ü–õ–û–ô –ù–ê –°–ï–†–í–ï–†

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. **–õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ
chmod +x scripts/*.sh

# –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å .env.example
cp .env.example .env.test
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
python3 scripts/validate-env.py --env-file .env.test

# –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑ –ª–æ–∫–∞–ª—å–Ω–æ
docker build -f Dockerfile.python -t sigmatrade:test .

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±—Ä–∞–∑ —Ä–∞–±–æ—Ç–∞–µ—Ç
docker run --rm sigmatrade:test python -c "import app; import bot; print('OK')"
```

2. **–ö–æ–º–º–∏—Ç –∏ –ø—É—à –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```bash
git add .
git commit -m "chore: prepare for production deployment

- Improved validation scripts
- Added health check script
- Enhanced Docker configuration
- Updated documentation
- Added error handling improvements"

git push origin claude/sigmatradebot-python-migration-01UUhWd7yPartmZdGxtPAFLo
```

### –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É:**
```powershell
# –ò–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã (Windows PowerShell)
gcloud compute ssh sigmatrade-20251108-210354 --zone=europe-north1-a
```

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:**
```bash
# 1. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
sudo mkdir -p /opt/sigmatradebot
sudo chown -R $USER:$USER /opt/sigmatradebot

# 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
cd /opt/sigmatradebot
git clone -b claude/sigmatradebot-python-migration-01UUhWd7yPartmZdGxtPAFLo \
  https://github.com/Avertenandor/sigmatradebot.git .

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
chmod +x scripts/*.sh
./scripts/server-deploy.sh

# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# - –ù–∞—Å—Ç—Ä–æ–∏—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ
# - –°–æ–∑–¥–∞—Å—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
# - –°–æ–±–µ—Ä–µ—Ç Docker –æ–±—Ä–∞–∑—ã
# - –ó–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
# - –ü–æ–∫–∞–∂–µ—Ç –ª–æ–≥–∏

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã
./scripts/health-check.sh
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ü–û–î–î–ï–†–ñ–ö–ê

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# Health check
cd /opt/sigmatradebot
./scripts/health-check.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose -f docker-compose.python.yml logs --tail=100 --timestamps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats --no-stream

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h
```

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
cd /opt/sigmatradebot
git pull origin claude/sigmatradebot-python-migration-01UUhWd7yPartmZdGxtPAFLo

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
docker-compose -f docker-compose.python.yml build --no-cache

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker-compose -f docker-compose.python.yml restart

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backup
ls -lh backups/
```

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã

**–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è:**
- –ü–∞–¥–µ–Ω–∏–µ –ª—é–±–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞ > 80%
- –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö –±–æ—Ç–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ blockchain
- –ù–µ—É–¥–∞—á–Ω—ã–µ backup

---

## üìù –ò–¢–û–ì–û–í–´–ô –ß–ï–ö–õ–ò–°–¢

**–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ —Å–∫–∞–∑–∞—Ç—å "–ì–æ—Ç–æ–≤–æ":**

### –ö–æ–¥
- [ ] –í—Å–µ P0 –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è settings.py –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —É–ª—É—á—à–µ–Ω–∞
- [ ] Health check —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω
- [ ] –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç

### –°–∫—Ä–∏–ø—Ç—ã
- [ ] server-deploy.sh —É–ª—É—á—à–µ–Ω
- [ ] validate-env.py –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ
- [ ] health-check.sh —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ

### Docker
- [ ] docker-compose.python.yml –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω
- [ ] docker-entrypoint.sh –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
- [ ] Health checks –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] –û–±—Ä–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] DEPLOY_TO_SERVER.md –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –æ–ø–∏—Å–∞–Ω—ã
- [ ] –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ß–µ–∫–ª–∏—Å—Ç—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã

### –î–µ–ø–ª–æ–π
- [ ] –ö–æ–¥ –∑–∞–∫–æ–º–º–∏—á–µ–Ω –∏ –∑–∞–ø—É—à–µ–Ω
- [ ] –°–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é
- [ ] .env –∑–∞–ø–æ–ª–Ω–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] Health check –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] –õ–æ–≥–∏ —á–∏—Å—Ç—ã–µ (–Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫)
- [ ] Backup —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ë–æ—Ç—É –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å /start

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ö–æ–º–∞–Ω–¥–∏—Ä, —ç—Ç–æ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è Cursor IDE.

**–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
1. –ù–∞—á–∞—Ç—å —Å P0 –∑–∞–¥–∞—á (–∫—Ä–∏—Ç–∏—á–Ω–æ)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —á–µ–∫–ª–∏—Å—Ç—ã
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
4. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ health-check

**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è:**
- P0 –∑–∞–¥–∞—á–∏: 2-3 —á–∞—Å–∞
- P1 –∑–∞–¥–∞—á–∏: 1-2 —á–∞—Å–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 1 —á–∞—Å
- –î–µ–ø–ª–æ–π: 30 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: 4-6 —á–∞—Å–æ–≤**

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1. `scripts/validate-env.py` - –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
2. `scripts/health-check.sh` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π
3. `app/config/settings.py` - –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
4. `bot/main.py` - —É–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
5. `docker-entrypoint.sh` - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ! üöÄ**

